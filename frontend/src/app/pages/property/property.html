<div class="container py-4">
  <h2 class="mb-4 fw-bold">Property Management</h2>

  <!-- Formulaire -->
  <div class="card shadow-sm mb-4">
    <form #propertyForm="ngForm" 
          (ngSubmit)="editMode() ? updateProperty(propertyForm) : addProperty(propertyForm)">
      
      <!-- Price -->
      <div class="mb-3">
        <label class="form-label fw-semibold">
          <i class="bi bi-cash-coin text-primary me-1"></i> Price ($)
        </label>
        <input type="number" class="form-control"
               [(ngModel)]="newProperty().Price"
               name="price" #price="ngModel" required>
        <div *ngIf="price.invalid && price.touched" class="text-danger small">
          Price is required
        </div>
      </div>

      <!-- Address -->
      <div class="mb-3">
        <label class="form-label fw-semibold">
          <i class="bi bi-geo-alt text-danger me-1"></i> Address
        </label>
        <input type="text" class="form-control"
               [(ngModel)]="newProperty().Address"
               name="address" #address="ngModel" required>
        <div *ngIf="address.invalid && address.touched" class="text-danger small">
          Address is required
        </div>
      </div>

      <!-- Property Type -->
      <div class="mb-3">
        <label class="form-label fw-semibold">
          <i class="bi bi-building text-success me-1"></i> Property Type
        </label>
        <select class="form-select"
                [(ngModel)]="newProperty().PropertyType"
                name="propertyType" #propertyType="ngModel" required>
          <option value="" disabled selected>-- Select Type --</option>
          <option value="Residential">Residential</option>
          <option value="Commercial">Commercial</option>
        </select>
        <div *ngIf="propertyType.invalid && propertyType.touched" class="text-danger small">
          Property type is required
        </div>
      </div>

      <!-- Purchase Date -->
      <div class="mb-3">
        <label class="form-label fw-semibold">
          <i class="bi bi-calendar-date text-warning me-1"></i> Purchase Date
        </label>
        <input type="date" class="form-control"
               [min]="today"
               [(ngModel)]="newProperty().PurchaseDate"
               name="purchaseDate" #purchaseDate="ngModel" required>
        <div *ngIf="purchaseDate.invalid && purchaseDate.touched" class="text-danger small">
          Purchase date is required
        </div>
      </div>

      <!-- Status -->
      <div class="mb-3">
        <label class="form-label fw-semibold">
          <i class="bi bi-check-circle text-info me-1"></i> Status
        </label>
        <select class="form-select"
                [(ngModel)]="newProperty().Status"
                name="status" #status="ngModel" required>
          <option value="" disabled selected>-- Select Status --</option>
          <option value="Occupied">Occupied</option>
          <option value="Vacant">Vacant</option>
        </select>
        <div *ngIf="status.invalid && status.touched" class="text-danger small">
          Status is required
        </div>
      </div>

      <!-- Buttons -->
      <button type="submit" class="btn btn-primary me-2" [disabled]="propertyForm.invalid">
        {{ editMode() ? 'Update Property' : 'Add Property' }}
      </button>
      <button type="button" class="btn btn-secondary" (click)="cancelEdit()" *ngIf="editMode()">
        Cancel
      </button>
    </form>
  </div>

  <!-- Property List -->
  <div class="card shadow-sm">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h5 class="mb-0">Property List</h5>
    </div>    
    <div class="table-responsive">
      <table class="table table-striped table-hover mb-0 align-middle">
        <thead>
          <tr>
            <th>Property ID</th>
            <th>Price ($)</th>
            <th>Address</th>
            <th>Type</th>
            <th>Purchase Date</th>
            <th>Status</th>
            <th class="text-end">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let property of properties(); trackBy: trackById">
            <td>{{ property.PropertyID | number }}</td>
            <td>{{ property.Price | number }}</td>
            <td>{{ property.Address }}</td>
            <td>{{ property.PropertyType }}</td>
            <td>{{ property.PurchaseDate | date:'dd/MM/yyyy' }}</td>
            <td>
              <span class="badge"
                    [ngClass]="{
                      'bg-success': property.Status === 'Occupied',
                      'bg-secondary': property.Status === 'Vacant'
                    }">
                {{ property.Status }}
              </span>
            </td>
            <td class="text-end">
              <button class="btn btn-sm btn-outline-primary me-1" (click)="editProperty(property)">
                <i class="bi bi-pencil-square"></i> Edit
              </button>
              <button class="btn btn-sm btn-outline-danger" (click)="confirmDelete(property.PropertyID)">
                <i class="bi bi-trash"></i> Delete
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
