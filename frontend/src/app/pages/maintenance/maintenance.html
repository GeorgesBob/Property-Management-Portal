<div class="container py-4">
  <h2 class="mb-4 fw-bold">Maintenance Management</h2>

  <!-- Form -->
  <div class="card shadow-sm mb-4">
    <form #MaintenanceForm="ngForm" 
          (ngSubmit)="editMode() ? updateMaintenance(MaintenanceForm) : addMaintenance(MaintenanceForm)">

      <!-- Property ID -->
      <div class="mb-3">
        <label class="form-label fw-semibold">
          <i class="bi bi-cash-coin text-primary me-1"></i> Property ID
        </label>
        <input type="number" class="form-control"
               [(ngModel)]="newMaintenance().PropertyID"
               name="PropertyID" #PropertyID="ngModel" required>
        <div *ngIf="PropertyID.invalid && PropertyID.touched" class="text-danger small">
          Property ID is required
        </div>
      </div>

      <!-- Description -->
      <div class="mb-3">
        <label class="form-label fw-semibold">
          <i class="bi bi-geo-alt text-danger me-1"></i> Description
        </label>
        <input type="text" class="form-control"
               [(ngModel)]="newMaintenance().Description"
               name="Description" #Description="ngModel" required>
        <div *ngIf="Description.invalid && Description.touched" class="text-danger small">
          Description is required
        </div>
      </div>

      <!-- Scheduled Date -->
      <div class="mb-3">
        <label class="form-label fw-semibold">
          <i class="bi bi-calendar-date text-warning me-1"></i> Scheduled Date
        </label>
        <input type="date" class="form-control"
               [min]="today"
               [(ngModel)]="newMaintenance().ScheduledDate"
               name="ScheduledDate" #purchaseDate="ngModel" required>
        <div *ngIf="purchaseDate.invalid && purchaseDate.touched" class="text-danger small">
          Date is required
        </div>
      </div>

      <!-- Status -->
      <div class="mb-3">
        <label class="form-label fw-semibold">
          <i class="bi bi-check-circle text-info me-1"></i> Status
        </label>
        <select class="form-select"
                [(ngModel)]="newMaintenance().Status"
                name="status" #status="ngModel" required>
          <option value="" disabled selected>-- Select Status --</option>
          <option value="Pending">Pending</option>
          <option value="In Progress">In Progress</option>
          <option value="Completed">Completed</option>
        </select>
        <div *ngIf="status.invalid && status.touched" class="text-danger small">
          Status is required
        </div>
      </div>

      <!-- Buttons -->
      <button type="submit" class="btn btn-primary btn-action me-2" [disabled]="MaintenanceForm.invalid">
        <i class="bi" [ngClass]="editMode() ? 'bi-arrow-repeat' : 'bi-plus-circle'"></i>
        {{ editMode() ? 'Update Maintenance' : 'Add Maintenance' }}
      </button>
      <button type="button" class="btn btn-secondary btn-action" (click)="resetForm()" *ngIf="editMode()">
        <i class="bi bi-x-circle"></i> Cancel
      </button>
    </form>
  </div>

  <!-- Maintenance List -->
  <div class="card shadow-sm">
    <div class="card-header">
      <h5 class="mb-0">Maintenance List</h5>
    </div>    
    <div class="table-responsive">
      <table class="table table-striped table-hover mb-0 align-middle">
        <thead>
          <tr>
            <th>Scheduled Date</th>
            <th>Status</th>
            <th>Description</th>
            <th class="text-end">Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (Maintenance of maintenances(); track Maintenance.TaskID) {
            <tr>
              <td>{{ Maintenance.ScheduledDate }}</td>
              <td>
                <span class="badge" [ngClass]="Maintenance.Status === 'Completed' ? 'bg-success': 'bg-secondary' ">
                  {{ Maintenance.Status }}
                </span>
              </td>
              <td>
                {{ Maintenance.Description }}
              </td>
              <td class="text-end">
                <button class="btn btn-sm btn-outline-primary me-2" (click)="editMaintenance(Maintenance)">
                  <i class="bi bi-pencil-square me-1"></i> Edit
                </button>
                <button class="btn btn-sm btn-outline-danger" (click)="deleteMaintenance(Maintenance.TaskID)">
                  <i class="bi bi-trash me-1"></i> Delete
                </button>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  </div>
</div>
